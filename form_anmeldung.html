<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Anmeldung</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 12px; }
    select, input { width: 250px; padding: 6px; }
    button { margin-top: 20px; padding: 10px 20px; }
</style>
</head>
<body>

<h2>Anmeldung</h2>

<form id="anmeldeForm">
    <label>Vorname:
        <input type="text" id="vorname" required>
    </label>

    <label>Nachname:
        <input type="text" id="nachname" required>
    </label>

    <label>Email:
        <input type="email" id="email" required>
    </label>

    <p>Ich benötige eine Mitfahrgelegenheit</p>

    <label>für meine Person:
        <select id="Person" required>
            <option value="">zutreffendes auswählen</option>
            <option value="nein">nein</option>
            <option value="ja">ja</option>
        </select>
    </label>

    <label>für mein EBike:
        <select id="EBike" required>
            <option value="">zutreffendes auswählen</option>
            <option value="nein">nein</option>
            <option value="ja">ja</option>
        </select>
    </label>

    <label>für mein unmotorisiertes Fahrrad:
        <select id="unmotorisiertesFahrrad" required>
            <option value="">zutreffendes auswählen</option>
            <option value="nein">nein</option>
            <option value="ja">ja</option>
        </select>
    </label>

    <button type="button" onclick="absenden()">absenden</button>
</form>

<script>
// Mail aus URL übernehmen
function getMailto() {
    const params = new URLSearchParams(window.location.search);

    const mail = params.get("mail") || "Reimann_Detlev@t-online.de";
    const subject = params.get("subject") || "Anmeldung zur Radtour";
    const body = params.get("body") || "Hallo Herr Reimann,\n\nich möchte mich zur Tour anmelden.";

    return "mailto:" + mail
        + "?subject=" + encodeURIComponent(subject)
        + "&body=" + encodeURIComponent(body);
}

// Dateiname anhand der Ursprungsseite
function getDateiname() {
    const ref = document.referrer;

    if (ref.includes("page2_hienheim1402026.html"))
        return "page2_hienheim14052026_Teilnehmerliste.xlsx";

    if (ref.includes("page3_luhe07062026.html"))
        return "page3_luhe07062026_Teilnehmerliste.xlsx";

    if (ref.includes("page4_Nittenau06092026.html"))
        return "page4_Nittenau06092026_Teilnehmerliste.xlsx";

    return "Teilnehmerliste.xlsx";
}

function absenden() {
    const felder = ["vorname", "nachname", "email", "Person", "EBike", "unmotorisiertesFahrrad"];

    for (let id of felder) {
        const feld = document.getElementById(id);
        if (!feld.value) {
            feld.focus();
            alert("Bitte eine Eingabe machen.");
            return;
        }
    }

    const dateiname = getDateiname();

    // Daten sammeln
    const daten = {
        Vorname: document.getElementById("vorname").value,
        Nachname: document.getElementById("nachname").value,
        Email: document.getElementById("email").value,
        Person: document.getElementById("Person").value,
        EBike: document.getElementById("EBike").value,
        unmotorisiertesFahrrad: document.getElementById("unmotorisiertesFahrrad").value,
        Zeitstempel: new Date().toLocaleString()
    };

    // JSON speichern
    const blob = new Blob([JSON.stringify(daten, null, 2)], { type: "application/json" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = dateiname.replace(".xlsx", ".json");
    link.click();

    // Mail öffnen
    window.location.href = getMailto();
}
</script>

</body>
</html>
