<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Anmeldung</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 12px; }
    select, input { width: 250px; padding: 6px; }
    button { margin-top: 20px; padding: 10px 20px; }
</style>
</head>
<body>

<h2>Anmeldung</h2>

<form id="anmeldeForm">
    <label>Vorname:
        <input type="text" id="vorname" required>
    </label>

    <label>Nachname:
        <input type="text" id="nachname" required>
    </label>

    <label>Email:
        <input type="email" id="email" required>
    </label>
    <p> Ich benötige eine Mitfahrgelegenheit</p>
    <label>für meine Person:
        <select id="Person" required>
            <option value="">zutreffendes auswählen</option>
            <option value="nein">nein</option>
            <option value="ja">ja</option>
        </select>
    </label>

    <label>für mein E-Bike:
        <select id="E-Bike" required>
            <option value="">zutreffendes auswählen</option>
            <option value="nein">nein</option>
            <option value="ja">ja</option>
        </select>
    </label>

    <label>für mein unmotorisiertes Fahrrad:
        <select id="unmotorisertesFahrrad" required>
            <option value="">zutreffendes auswählen</option>
            <option value="nein">nein</option>
            <option value="ja">ja</option>
        </select>
    </label>

    <button type="button" onclick="absenden()">absenden</button>
</form>

<script>
// Ermittelt anhand der URL, welche Excel-Datei verwendet werden soll
function getDateiname() {
    const ref = document.referrer;

    if (ref.includes("page2_hienheim1402026.html"))
        return "page2_hienheim14052026_Teilnehmerliste.xlsx";

    if (ref.includes("page3_luhe07062026.html"))
        return "page3_luhe07062026_Teilnehmerliste.xlsx";

    if (ref.includes("page4_Nittenau06092026.html"))
        return "page4_Nittenau06092026_Teilnehmerliste.xlsx";

    return "Teilnehmerliste.xlsx";
}

function absenden() {
    const felder = ["vorname", "nachname", "email", "Person", "E-Bike", "unmotorisiertesFahrrad"];

    for (let id of felder) {
        const feld = document.getElementById(id);
        if (!feld.value) {
            feld.focus();
            alert("Bitte eine Eingabe machen.");
            return;
        }
    }

    const dateiname = getDateiname();

    // Daten sammeln
    const daten = {
        Vorname: document.getElementById("vorname").value,
        Nachname: document.getElementById("nachname").value,
        Email: document.getElementById("email").value,
        Person: document.getElementById("helm").value,
        E-Bike: document.getElementById("erfahrung").value,
        unmotorisiertesFahrrad: document.getElementById("gesundheit").value,
        Zeitstempel: new Date().toLocaleString()
    };

    // Speichern als JSON (Excel geht auf GitHub Pages nicht direkt)
    const blob = new Blob([JSON.stringify(daten, null, 2)], { type: "application/json" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = dateiname.replace(".xlsx", ".json");
    link.click();

    // E-Mail öffnen
    window.location.href = "mailto:detlev.reimann@t-online.de?subject=Neue Anmeldung&body=Eine neue Anmeldung wurde gespeichert.";
}
</script>

</body>
</html>
